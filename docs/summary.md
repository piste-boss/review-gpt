# ドキュメント（日本語版）

大磯屋さま向け口コミ生成・投稿ナビアプリ「review-gpt」の概要と設計方針をまとめた日本語ドキュメントです。  
QR コードからの誘導〜アンケート回答〜AI 生成文の投稿までをスマートフォン完結で支援し、Gemini API を活用したレビュー生成体験を提供します。

---

## 1. プロジェクト背景と目的
- 店頭・イベントで配布する QR コードから、**ライト／ミディアム／フルシティ**の 3 ルートに応じたアンケートへ誘導し、回答ハードルに応じた UX を実現する。
- 回答完了後に AI が作成したサンプル口コミを提示し、Google マップなど外部プラットフォームへの投稿導線をシームレスに確保する。
- 管理画面でルータ設定・アンケート設問・生成プロンプトを即時編集し、Netlify Blobs に保存することでコード変更なしで運用チューニングできる構成を目指す。

---

## 2. 主要画面とユーザーフロー
### ルータページ `/`
- 3 種のカップカード（ライト／ミディアム／フルシティ）を表示し、タップ時に `/api/distribute` がローテーションしたアンケート URL を返却。
- カード文言・遷移先 URL・配信順は「ルータ設定」タブから編集でき、イベントごとのチューニングが数クリックで完了。

### 管理画面 `/admin`
- **トップページリンク**: 3 ルートの遷移先・順番・再配信ルールを管理。
- **システム設定**: Gemini モデルと API キー、アンケート送信先 API/キー、回答取得用 GAS URL を登録。表示制御により秘匿情報へのアクセスを限定。
- **アクセスガイド**: `/user` 画面への導線や運用フローの共有に使用。
- **プロンプトジェネレーター**: 口コミ生成用のプロンプト、ライト／スタンダード／プラチナ例文、Gemini API モデルをまとめて管理し、生成品質をブラウザ上で最適化。

### ユーザー設定 `/user`
- **ユーザー情報タブ**で店舗名・カタカナ表記・業種・客層・強み・駅近フラグ、検索で押さえたいワード1〜5・除外ワード1〜5、Google マップの口コミリンクを保存。
- 運用担当者が日常的に触れる要素（トップページ文言／ブランド、アンケート1〜3、AI プロンプト、回答保存先、QR 生成）を一画面に集約。
- ルーティングや API キーなどシステム寄りの項目は `/admin` 側へ寄せ、権限分離をしやすくしている。

### 生成ページ `/generator`, `/generator/page2`, `/generator/page3`
- それぞれライト／ミディアム／フルシティのアンケートに対応。
- 各ページは `data-prompt-key` と `data-tier` を基に `/api/generate` を呼び出し、GAS から取得した回答データ＋プロンプトを Gemini API(v1) へ送信。
- 生成された口コミはコピー・Google マップ投稿導線をワンタップで利用可能。

### アンケートフォーム（`form1`〜`form3`）
- 管理画面の設定を読み込みつつ、質問内容・星評価・複数回答可否などを反映。
- 回答は設定済みの Web API に POST（未設定時はローカル保持）し、送信後に該当する生成ページへ遷移して AI 例文を提示。

---

## 3. バックエンドとデータフロー
1. フロントエンドは Vite + React（TypeScript）構成で、Netlify にデプロイ。
2. 永続設定は **Netlify Blobs** に JSON で保存。API キー等の秘匿情報は平文で保持されるため、Netlify 側のアクセス権限で保護する。
3. 主要 Netlify Functions
   - `config`: 管理画面の各タブ設定をまとめて CRUD。
   - `distribute`: ボタンごとに設定した URL をラウンドロビンで返却し、平均的に誘導する。
   - `generate`: GAS → Gemini API のブリッジとして回答データを受け取り、生成テキストを返す。
   - `upload`: Blobs 動作確認用のサンプル。
4. フォーム送信時には `formKey`・回答本体・メタデータをまとめて指定 API へ送信し、必要に応じて GAS や外部 DB で集計する。

---

## 4. デザイン・ブランド方針
- フォント: Noto Sans / Zen Maru Gothic を採用し、柔らかく読みやすい印象に統一。
- カラーパレット: ピンク〜サーモン系のグラデーションを基調に、コーヒーカップのライト〜フルシティを想起させる配色を適用。
- 全ページで「ライトカップ」「ミディアムカップ」「フルシティカップ」の呼称を統一し、Instagram ライクなカード UI で視認性とタップしやすさを担保。

---

## 5. 開発・運用メモ
- ローカル開発: `npm install` → `npm run dev`。
- ビルド&デプロイ: `npm run build` で `dist/` を生成し、`netlify deploy --prod --dir=dist` で本番更新。
- Netlify で設定する環境変数
  - `NETLIFY_SITE_ID`
  - `NETLIFY_BLOBS_TOKEN`（または `NETLIFY_AUTH_TOKEN`）
- Gemini API キーやアンケート送信先 API/キーは管理画面から登録し、保存後すぐに Netlify Blobs へ反映。
- デプロイ後は QR コード生成タブから最新 URL のコードを発行し直し、イベント配布物を更新すると安全。

---

## 6. 今後の検討事項
- アンケート回答内容の永続化と検索（例: Supabase/S3 等との連携）。
- 口コミ生成プロンプトの A/B テストや自動チューニング機能。
- フォーム回答と投稿状況を集約する可視化ダッシュボード。
- Playwright などを使った管理画面・フォームの自動回帰テスト整備。
