# ドキュメント（日本語版）

大磯屋さま向け口コミ生成・投稿ナビアプリ「review-gpt」のプロジェクトサマリーです。  
スマートフォンでの誘導に特化し、来店者の回答ボリュームに応じて 3 つのアンケート経路へ振り分けつつ、Gemini API で生成した口コミを各種プラットフォームへ投稿できます。

---

## 1. プロジェクトの背景と目的
- 店頭やイベントで配布する QR コードから、**ライト／ミディアム／フルシティ**の 3 レベルに応じたアンケートへ誘導。
- 回答後は自動的に AI 生成のサンプル文章を提示し、そのまま Google マップ等へ投稿してもらう導線を確保。
- 管理者はブラウザ上の管理画面からリンクやプロンプトを編集でき、Netlify Blobs に保存して即時反映できます。

---

## 2. 画面構成と機能
### ルータページ `/`
1. トップで 3 種のカップ（ライト／ミディアム／フルシティ）を提示し、タップすると `/api/distribute` がローテーションしたアンケート URL を返却。
2. ルータのラベルとリンク先は管理画面の「ルータ設定」で編集可能。

### 管理画面 `/admin`
- **トップページリンク先**: ルータ（初級/中級/上級）の遷移先 URL を一括管理し、ローテーション配信の順番を設定。
- **システム設定**: Gemini モデル、API キー、アンケート送信先 API/キー、アンケートデータ取得用 GAS URL を登録し、セキュリティを考慮した設定のみを表示。
- **アクセスガイド**: `/user` への導線を表示し、日常運用とシステム設定を明確に分離。
- **プロンプトジェネレーター**: 口コミ用 Gemini API と生成用プロンプト、ライト/スタンダード/プラチナの参考文面を管理。

### ユーザー設定 `/user`
- **ユーザー情報タブ**: 店舗名／カタカナ／業種／客層／強み／駅近フラグ、検索で意識させたいワード1〜5・除外ワード1〜5、口コミリンク（GoogleマップURL）を保存。
- 運用担当者が触れるセクション（トップページ表示文言・ブランド、アンケート1〜3、AI プロンプト、アンケート保存先、QR 生成）を集約。
- トップページではボタン文言とブランド（ファビコン）を調整し、リンク先は `/admin` 側で一元管理。
- システム系の API キーや送信先は `/admin` 側に集約し、権限を分離。

### 生成ページ `/generator`, `/generator/page2`, `/generator/page3`
- それぞれライト／ミディアム／フルシティに対応。
- `data-prompt-key` と `data-tier` をもとに `/api/generate` を呼び出し、GAS から取得した回答データ＋プロンプトを Gemini API(v1) へ送信。
- 生成結果のコピー・マップ投稿導線をワンタップで利用可能。

### アンケートフォーム（`form1`〜`form3`）
- 管理画面設定を読み込んだうえで、回答を指定の Web API（設定未入力時はローカル保持のみ）に POST。
- 送信後は該当する生成ページへ遷移して AI 文例を案内。

---

## 3. バックエンドとデータフロー
1. フロントエンドは Vite + React（TypeScript）で構成。
2. 永続設定は **Netlify Blobs** に JSON 保存。API キーなど秘匿情報は平文保存になるため、アクセス権限で保護。
3. 主要 Netlify Functions:
   - `config`: 各タブの CRUD API。タブ種別をキーにまとめて保存。
   - `distribute`: ボタンごとに設定された URL をラウンドロビン配信。
   - `generate`: GAS → Gemini API のブリッジ。生成文章を返却。
   - `upload`: Blobs 動作確認用サンプル。
4. フォーム送信時には `formKey`・回答内容・メタデータをまとめて指定 API へ送信。

---

## 4. デザインとブランド方針
- フォント: Noto Sans / Zen Maru Gothic。
- カラーパレット: 柔らかいピンク〜サーモン系グラデーション。
- 各ページで「ライトカップ」「ミディアムカップ」「フルシティカップ」の呼称を統一し、Instagram ライクなカード UI で視認性を確保。

---

## 5. 開発・運用メモ
- ローカル開発: `npm install` → `npm run dev`。
- ビルド: `npm run build` で `dist/` を生成し、`netlify deploy --prod --dir=dist` で本番更新。
- Netlify で必要な環境変数
  - `NETLIFY_SITE_ID`
  - `NETLIFY_BLOBS_TOKEN`（もしくは `NETLIFY_AUTH_TOKEN`）
- Gemini API キー、アンケート送信先 API/キーなどは管理画面から登録。
- 本番更新後は QR コード生成タブで最新 URL のコードを再出力して配布すると安全。

---

## 6. 今後の検討事項
- アンケート回答内容の永続化・検索（例: Supabase 連携）。
- AI 生成テンプレートの A/B テスト機能。
- フォーム回答と投稿状況を可視化するダッシュボード。
- Playwright 等を使った管理画面・フォームの自動回帰テスト。
